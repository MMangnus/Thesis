\section{Introduction}
%The field
With functional Magnetic Resonance Imaging (fMRI) neuronal activity in the brain is measured indirectly via the Blood Oxygen Level Dependent (BOLD) response. With the emergence of higher static magnetic fields, more powerful acquisition sequences and better analysis tools, the location of the activation can be pinpointed  more  precisely. The attainable spatial resolution can be \add{so high that voxels are} smaller than the thickness of the cerebral cortex. These improvements have made it possible to investigate specific cortical layers with fMRI.
Typically the human cerebral cortex consists of six \change{histological}{cytoarchitectonic} layers \cite{Brodmann1909}. Layer IV is commonly associated with receiving feedforward input from Layer III from lower cortical areas or from the thalamus \cite{Jones1998}, while Layers II-III and VI are implicated in receiving downward information flow (feedback) \cite{Alitto2003}, which often originates from layer V. Layer I is thin and sparsely populated with neurons and will probably remain elusive to laminar fMRI. 

% Recent work
It is clear that there may be a lot of information about laminar processing in fMRI measures. The BOLD signal has convincingly been shown to have a laminar origins in the rat motor- and somatosensory cortices \cite{Yu2014}. Further tight spatial coupling has been demonstrated of blood flow and dilation of arterioles of layer II/III and orientation tuning in the cat visual cortex \cite{OHerron2016}. And in line with previous depth-dependent electrode recordings, the BOLD response that uniquely reflects trial by trial variance in the alpha and gamma bands was recently shown to be consistent with infra- and supra-granular origins of these oscillations \cite{Scheeringa2016}. While the details of the neurovascular coupling are still unknown \cite{Uludag2017}, \change{it has long been accepted that the BOLD response best reflects the LFP signal}{the cortical BOLD response has been modelled as a function of depth and could potentially even be deconvolved to get a better estimate of the origin of cortical activation} \cite{Markuerkiaga2016}. The work of Scheeringa et al. suggests that the laminar BOLD response as measured in humans \cite[e.g.]{Koopmans2010,Polimeni2010,Maass2014,Kok2016} contains distinguishable laminar responses. \add{But also CBV measurements show laminar differentiation and is suggested to be even more sensitive than BOLD} \cite{Huber2017}.
If this is indeed the case, laminar fMRI could give us the means of measuring directional communication between brain regions. For this reason, extracting reliable and meaningful layer specific time courses in humans has been \change{called one of the `Holy Grails' of neuroscience}{recognised as essential to get a better understanding of the nature of computations that are performed by the brain} \cite{Barazany2012,Lawrence2017}. 

%The background
Hitherto little attention has been paid to the question of how to extract laminar signals from high spatial resolution fMRI data. Voxels are sometimes manually classified to be part of layers at different cortical depths \cite[e.g.]{Siero2011,Olman2012,Maass2014}. Other attempts included drawing lines perpendicular to the surface and interpolating the volume, either manually \cite{Koopmans2010}, or using a cortical mesh reconstruction \cite[e.g.]{Koopmans2011,Polimeni2010,DeMartino2013}.
%sampling
The variation in the distribution of the histological layers over cortical depth in gyri and sulci was identified as a challenge for laminar fMRI \cite{Ress2007}. This is why several studies chose to analyse straight pieces of cortex only \cite{Koopmans2010,Olman2012,DeMartino2013}. The way that the layer thickness varies over the cortex relates to the curvature and was found to behave according to an equivolume principle \cite{Bok1929,Waehnert2014}, which can be modelled by means of a level set framework \cite{Sethian1999}\change{. An equivalent equivolume sampling algorithm is also described for surface based analysis}{, or equivalently with a surface based sampling algorithm}
\cite{Kleinnijenhuis2015}.

% %The problem with sampling
Even if the \change{histological}{cytoarchitectonic} layer \change{topology}{topography} was known throughout the cortex, it would still be challenging to extract laminar signals. As the fMRI data will generally consist of cubic voxels, these voxels will almost certainly contain signal from several layers. Any kind of interpolation will lead to contamination from neighbouring layers. This effect is reduced with higher resolution, but the contamination effect in relation to the spatial resolution has never been quantified. The term `laminar resolution' \cite{Ugurbil2012,Huber2015} has been used to roughly mean sub-millimetre resolution. While it is certainly improbable to get laminar specific results at lower resolutions, the one millimetre threshold is arbitrary. Given that the cortex is on average 3 millimetres thick \cite{Zilles1990,Fischl2000}, the resolution requirements may well change dependent on the cortical area considered and the layers of interest. 

%The solution
Here we propose a method to reliably extract time courses from a cortical area by using the framework of the General Linear Model (GLM). This offers a potential solution to the partial volume problem, for the situation in which a common laminar signal can be assumed over a number of voxels that is large compared to the number of layers. Instead of interpolating and integrating, we propose to decompose the layer signals by means of a spatial GLM. While in the limit of infinitesimal voxel volume all methods should yield the same result, our method aims to retrieve more accurate results at coarser resolutions. An added benefit is that the mathematical assumptions underlying the GLM are known and their validity may be tested within a data set. This work has previously been presented in abstract form \cite{VanMourikISMRM2015}. A \change{related laminar mixture model with a different mathematical underpinning}{similar suggestion for a laminar mixture model} was presented in abstract form by Polimeni et al. \cite{PolimeniISMRM2010}.
 
%Introduction of the rest of the paper
Herein we describe the theory and implementation of the spatial GLM. We explain in detail the pipeline for laminar data processing and the extraction of the laminar profile. In order to test the power of the spatial GLM, we employed a simple simulation to generate a curved model cortex which satisfies the equivolume principle. This allowed us to set a gold standard on which we could test our method and compare it with other laminar signal extraction methods. In addition, we validated our method using high resolution structural data in order to show that we could obtain a profile that preserves underlying anatomical structures. Lastly, we tested whether we could extract robust profiles across grey matter from structural scans. We anticipate that the main use of the spatial GLM will be in the extraction of functional time courses, and have already utilised this technique to detect layer specific feedback signals in human primary visual cortex \cite{Kok2016,VanMourik2018a}. In their respective supplementary materials, comparisons can be found with existing methods. In the current work our emphasis is on giving a full description of this technique, and validating it in situations where a known ground truth can be postulated. We eschew here any attempt to validate the spatial GLM on the basis of fMRI data as a generally accepted ground-truth pattern of laminar activation does not currently exist.



